
<!DOCTYPE html>
<html>
<head>
	<title>Leaflet GeoJSON Example</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="/lib/leaflet/css/leaflet.css" />
</head>
<body>
	<div id="map" style="width: 800px; height: 600px"></div>

	<script src="/lib/leaflet/js/leaflet.js"></script>
	<script src="/lib/jquery/js/jquery-2.1.1.js"></script>

	<script>
		var map = L.map('map').setView([39.305969,-76.616538], 15);

		L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a>'
		}).addTo(map);

		var parcels;
		var refreshParcels = function(){
			var bounds = map.getBounds();
			L.polyline([[bounds.getSouth(),bounds.getWest()],[bounds.getNorth(),bounds.getEast()]],{color: '#f00'}).addTo(map);
			$.ajax({
			  url: "/bounds",
			  data: {
			  	bbox: bounds.getSouth()+','+bounds.getWest()+','+bounds.getNorth()+','+bounds.getEast()
			  }
			}).done(function( data ) {
				if (parcels) {
					map.removeLayer(parcels);
				}
				parcels = L.geoJson(data, {
					style: function(feature) {
						return {
							color: '#00f'
						};
					},
					onEachFeature: function(feature, layer) {
						layer.bindPopup(feature.properties.address + ' | ' + feature.properties.blocklot);
					}
				});
				parcels.addTo(map);
			});
		};

		map.on('moveend', refreshParcels);
		map.on('zoomend', refreshParcels);


	</script>
</body>
</html>
